{
  "id": "https://schema.management.azure.com/schemas/2022-10-11-preview/Microsoft.TestBase.json#",
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Microsoft.TestBase",
  "description": "Microsoft TestBase Resource Types",
  "resourceDefinitions": {
    "testBaseAccounts_draftPackages": {
      "type": "object",
      "properties": {
        "apiVersion": {
          "type": "string",
          "enum": [
            "2022-10-11-preview"
          ]
        },
        "name": {
          "type": "string",
          "description": "The resource name of the Test Base Draft Package."
        },
        "properties": {
          "oneOf": [
            {
              "$ref": "#/definitions/DraftPackageProperties"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The properties of the Test Base Draft Package."
        },
        "type": {
          "type": "string",
          "enum": [
            "Microsoft.TestBase/testBaseAccounts/draftPackages"
          ]
        }
      },
      "required": [
        "apiVersion",
        "name",
        "properties",
        "type"
      ],
      "description": "Microsoft.TestBase/testBaseAccounts/draftPackages"
    }
  },
  "definitions": {
    "Command": {
      "type": "object",
      "properties": {
        "action": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "Install",
                "Launch",
                "Close",
                "Uninstall",
                "Custom",
                "FlowDrivenCustom"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The action of the command."
        },
        "alwaysRun": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies whether to run the command even if a previous command is failed."
        },
        "applyUpdateBefore": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies whether to apply update before the command."
        },
        "commandAlias": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "Install",
                "Uninstall"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies the test alias of the command for in-place upgrade test, the marked command would obtain extra supports in a test."
        },
        "content": {
          "type": "string",
          "description": "The content of the command. The content depends on source type."
        },
        "contentType": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "Inline",
                "File",
                "Path"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The type of command content."
        },
        "install1PAppBefore": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies whether to install first party applications before running the command."
        },
        "maxRunTime": {
          "oneOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies the max run time of the command."
        },
        "name": {
          "type": "string",
          "description": "The name of the command."
        },
        "postUpgrade": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies whether the command is assigned to be executed after in-place upgrade."
        },
        "preUpgrade": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies whether the command is assigned to be executed before in-place upgrade."
        },
        "restartAfter": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies whether to restart the VM after the command executed."
        },
        "runAsInteractive": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies whether to run the command in interactive mode."
        },
        "runElevated": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies whether to run the command as administrator."
        },
        "testToolType": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "PowerShell",
                "PowerAutomate"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Test tool type for this command."
        }
      },
      "required": [
        "action",
        "content",
        "contentType",
        "name"
      ],
      "description": "The command used in the test"
    },
    "DraftPackageIntuneAppMetadata": {
      "type": "object",
      "properties": {
        "intuneApp": {
          "oneOf": [
            {
              "$ref": "#/definitions/DraftPackageIntuneAppMetadataItem"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The Metadata of a single Intune App."
        },
        "intuneAppDependencies": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/DraftPackageIntuneAppMetadataItem"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The Metadata of dependencies of the Intune App."
        }
      },
      "description": "The metadata of Intune app used for generation."
    },
    "DraftPackageIntuneAppMetadataItem": {
      "type": "object",
      "properties": {
        "appId": {
          "type": "string",
          "description": "Intune app id."
        },
        "appName": {
          "type": "string",
          "description": "Intune app name."
        },
        "createDate": {
          "type": "string",
          "format": "date-time",
          "description": "Creation date of the app."
        },
        "dependencyIds": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Ids of dependency apps."
        },
        "dependentAppCount": {
          "oneOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Count of dependency apps."
        },
        "description": {
          "type": "string",
          "description": "Description of the app."
        },
        "expectedExitCodes": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Expected exit codes returned from Intune App."
        },
        "installCommand": {
          "type": "string",
          "description": "Install command."
        },
        "lastProcessed": {
          "oneOf": [
            {
              "type": "integer"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "last processed time tickets."
        },
        "minimumSupportedOS": {
          "type": "string",
          "description": "Minimum supported OS. The OS version must be greater than this version to run this app."
        },
        "owner": {
          "type": "string",
          "description": "Owner of the app."
        },
        "publisher": {
          "type": "string",
          "description": "Publisher of the app."
        },
        "setupFile": {
          "type": "string",
          "description": "Setup file path."
        },
        "status": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "Ready",
                "Uploading",
                "UploadFailed",
                "ExtractFailed",
                "NoDependencyApp"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Extract status."
        },
        "uninstallCommand": {
          "type": "string",
          "description": "Uninstall command."
        },
        "version": {
          "type": "string",
          "description": "Intune app version."
        }
      },
      "description": "The Metadata of a single Intune App."
    },
    "DraftPackageProperties": {
      "type": "object",
      "properties": {
        "appFileName": {
          "type": "string",
          "description": "The name of the app file."
        },
        "applicationName": {
          "type": "string",
          "description": "Application name"
        },
        "comments": {
          "type": "string",
          "description": "Comments added by user."
        },
        "editPackage": {
          "oneOf": [
            {
              "type": "boolean",
              "default": false
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies whether this draft package is used to edit a package."
        },
        "firstPartyApps": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/FirstPartyAppDefinition"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The list of first party applications to test along with user application."
        },
        "flightingRing": {
          "type": "string",
          "description": "The flighting ring for feature update."
        },
        "highlightedFiles": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/HighlightedFile"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The highlight files in the package."
        },
        "inplaceUpgradeOSPair": {
          "oneOf": [
            {
              "$ref": "#/definitions/InplaceUpgradeOSInfo"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies the baseline os and target os for in-place upgrade tests."
        },
        "intuneMetadata": {
          "oneOf": [
            {
              "$ref": "#/definitions/DraftPackageIntuneAppMetadata"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The metadata of Intune app used for generation."
        },
        "packageId": {
          "type": "string",
          "description": "Specifies the package id from which the draft package copied."
        },
        "packageTags": {
          "oneOf": [
            {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              },
              "properties": {}
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Resource tags."
        },
        "provisioningState": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "Succeeded",
                "Failed",
                "Cancelled",
                "Creating",
                "Deleting",
                "Updating"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The provisioning state of the resource."
        },
        "sourceType": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "Native",
                "IntuneWin",
                "TestBasePackage"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The source type."
        },
        "tabState": {
          "oneOf": [
            {
              "$ref": "#/definitions/TabState"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies current state of tabs."
        },
        "targetOSList": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/TargetOSInfo"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies the target OSs of specific OS Update types."
        },
        "tests": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/Test"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The detailed test information."
        },
        "testTool": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "PowerShell",
                "PowerAutomate"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Test Framework."
        },
        "useSample": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies whether a sample package should be used instead of the one uploaded by the user."
        },
        "version": {
          "type": "string",
          "description": "Application version"
        }
      },
      "required": [
        "applicationName",
        "version"
      ],
      "description": "The properties of the Test Base Draft Package."
    },
    "FirstPartyAppDefinition": {
      "type": "object",
      "properties": {
        "architecture": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "x86",
                "x64",
                "arm64",
                "arm",
                "ia64"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The architecture of a first party application of a Test Base Account."
        },
        "channel": {
          "type": "string",
          "description": "The channel info of a first party application of a Test Base Account."
        },
        "interopExecutionMode": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "firstPartyAppWithTests",
                "firstPartyApp"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies how the first party applications should be interoperated with user's application."
        },
        "name": {
          "type": "string",
          "description": "The media name of a first party application of a Test Base Account."
        },
        "ring": {
          "type": "string",
          "description": "The ring info of a first party application of a Test Base Account."
        }
      },
      "description": "Properties of the definition of a first party application of the Test Base package."
    },
    "HighlightedFile": {
      "type": "object",
      "properties": {
        "path": {
          "type": "string",
          "description": "The path of the highlighted file."
        },
        "sections": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The name of sections to highlight."
        },
        "visited": {
          "oneOf": [
            {
              "type": "boolean",
              "default": false
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "A flag to save whether this file is viewed by user."
        }
      },
      "required": [
        "path"
      ],
      "description": "The information of a highlighted file that user should pay attention to."
    },
    "InplaceUpgradeOSInfo": {
      "type": "object",
      "properties": {
        "baselineOS": {
          "oneOf": [
            {
              "$ref": "#/definitions/OsProperties"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The properties of an operating system."
        },
        "targetOS": {
          "type": "string",
          "description": "Specifies the target os for in-place upgrade tests."
        }
      },
      "description": "Specifies the baseline os and target os for in-place upgrade tests."
    },
    "OsProperties": {
      "type": "object",
      "properties": {
        "osName": {
          "type": "string",
          "description": "The name of the OS."
        },
        "releaseProperties": {
          "oneOf": [
            {
              "$ref": "#/definitions/ReleaseProperties"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The properties of an operating system release."
        }
      },
      "description": "The properties of an operating system."
    },
    "ReleaseProperties": {
      "type": "object",
      "properties": {
        "buildNumber": {
          "type": "string",
          "description": "The build number of the OS release."
        },
        "buildRevision": {
          "type": "string",
          "description": "The build revision of the OS release."
        },
        "releaseName": {
          "type": "string",
          "description": "The name of the OS release."
        },
        "releaseVersionDate": {
          "type": "string",
          "format": "date-time",
          "description": "The release version date of the OS release."
        }
      },
      "description": "The properties of an operating system release."
    },
    "TabState": {
      "type": "object",
      "properties": {
        "currentTab": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "Unspecified",
                "BasicsTab",
                "ConfigureTestTab",
                "EditPackageTab",
                "TestMatrixTab",
                "TagsTab",
                "ReviewAndCreateTab"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Current tab."
        },
        "visitedTabs": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "Unspecified",
                  "BasicsTab",
                  "ConfigureTestTab",
                  "EditPackageTab",
                  "TestMatrixTab",
                  "TagsTab",
                  "ReviewAndCreateTab"
                ]
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "visited tabs."
        }
      },
      "description": "Specifies current state of tabs."
    },
    "TargetOSInfo": {
      "type": "object",
      "properties": {
        "baselineOSs": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies the baseline OSs to be tested."
        },
        "insiderChannelIds": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Insider Channel Ids. Only used for feature update."
        },
        "osUpdateType": {
          "type": "string",
          "description": "Specifies the OS update type to test against, e.g., 'Security updates' or 'Feature updates'."
        },
        "targetOSs": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Specifies the target OSs to be tested."
        }
      },
      "required": [
        "osUpdateType"
      ],
      "description": "The information of the target OS to be tested."
    },
    "Test": {
      "type": "object",
      "properties": {
        "commands": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "#/definitions/Command"
              }
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The commands used in the test."
        },
        "isActive": {
          "oneOf": [
            {
              "type": "boolean"
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "Indicates if this test is active.It doesn't schedule test for not active Test."
        },
        "testType": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "OutOfBoxTest",
                "FunctionalTest",
                "FlowDrivenTest"
              ]
            },
            {
              "$ref": "https://schema.management.azure.com/schemas/common/definitions.json#/definitions/expression"
            }
          ],
          "description": "The type of the test."
        }
      },
      "required": [
        "commands",
        "testType"
      ],
      "description": "The definition of a Test."
    }
  }
}